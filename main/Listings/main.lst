C51 COMPILER V9.60.0.0   MAIN                                                              04/19/2020 01:28:07 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <c8051f020.h>
   2          #include "std_macros.h"
   3          #include "DIO.h"
   4          #include "Keypad.h"
   5          #include "SevenSegments.h"
   6          #define NOTPRESSED 0xff
   7          #define true 1
   8          #define false 0
   9          
  10          void checkPresed(void);
  11          
  12          void open(void);
  13          void stop(void);
  14          void close(void);
  15          void elevUP(void);
  16          void elecvDOWN(void);
  17          void elevSTOP(void);
  18          unsigned char presed,step,buttonFlagPresed;
  19          char sevensegmentValue,elevator;
  20          
  21          char up = false;
  22          char down = false;
  23          char buttonPresed[8] = {1,1,1,1,1,1,1,1};
  24          char buttonPresedFlags[8] = {0,0,0,0,0,0,0,0};
  25          char keypadFlags[5] = {0,1,2,3,4};
  26          char keypadvalues[5] = {0};
  27          char arr[4] = {0,1,2,3}; // sevenSegments number
  28          
  29          
  30          volatile char count = 0;
  31          volatile char count2 = 0;
  32          /*
  33          void ext_int_0() interrupt 0
  34          { 
  35              count = 0;
  36          }
  37          */
  38          
  39          
  40          void timer0_isr() interrupt 1
  41          {
  42   1        TH0 = 0X4B;        //ReLoad the timer value
  43   1          TL0 = 0XFD;
  44   1          count++;        // Toggle the LED pin 
  45   1          count2++;
  46   1      }
  47          
  48          void main (void)
  49          {
  50   1        sevensegmentValue = 0;
  51   1          seven_seg_write(0,sevensegmentValue,0);
  52   1        
  53   1        WDTCN = 0xDE;
  54   1        WDTCN = 0xAD;
C51 COMPILER V9.60.0.0   MAIN                                                              04/19/2020 01:28:07 PAGE 2   

  55   1        keypad_vInit(1);
  56   1      
  57   1        seven_seg_init(0,0);
  58   1        seven_seg_init(0,1);
  59   1      
  60   1        
  61   1        P3MDOUT &= 0x00;
  62   1        P3 = 0xff;
  63   1        
  64   1          TMOD = 0x01;       //Timer0 mode 1 
  65   1          TH0 = 0X4B;        //Load the timer value
  66   1          TL0 = 0XFD;
  67   1          TR0 = 1;           //turn ON Timer zero
  68   1          ET0 = 1;           //Enable TImer0 Interrupt
  69   1          EA = 1; 
  70   1         
  71   1        
  72   1      
  73   1        while(1)
  74   1        {
  75   2      
  76   2          checkPresed();
  77   2          for(step=0;step<8;step++)
  78   2            {
  79   3              if (buttonPresedFlags[step] == 1) 
  80   3              {
  81   4                buttonFlagPresed = 1;
  82   4              }
  83   3            }
  84   2          while(buttonFlagPresed)
  85   2        {
  86   3          
  87   3            if(buttonPresedFlags[0]==1 )  
  88   3              {
  89   4                if (sevensegmentValue == 0)
  90   4                  {
  91   5                    if( down && buttonPresedFlags[1])
  92   5                      {
  93   6                        open();
  94   6                        buttonPresedFlags[4] = 0;
  95   6                        down = false ;
  96   6                      }
  97   5                    else if ( !up && !down )
  98   5                      {
  99   6                        open();
 100   6                      }
 101   5                  }
 102   4                else
 103   4                  {
 104   5                    elevator = 0;
 105   5                  }
 106   4              }
 107   3            
 108   3            if(buttonPresedFlags[1]==1) 
 109   3              {
 110   4                if (sevensegmentValue == 3)
 111   4                  {
 112   5      
 113   5                    if (up && buttonPresedFlags[1])
 114   5                      { 
 115   6                        open();
 116   6                        buttonPresedFlags[3] = 0;
C51 COMPILER V9.60.0.0   MAIN                                                              04/19/2020 01:28:07 PAGE 3   

 117   6                        up = false;
 118   6                      }
 119   5                    else if ( !up && !down )
 120   5                      {
 121   6                        open();
 122   6                      }
 123   5                  }
 124   4                else
 125   4                  {
 126   5                    elevator = 3;
 127   5                  }
 128   4              }
 129   3              
 130   3            if(buttonPresedFlags[5]==1 || buttonPresedFlags[6]==1)  
 131   3              {
 132   4                if (sevensegmentValue == 2)
 133   4                  {
 134   5                    if( down && buttonPresedFlags[5])
 135   5                      {
 136   6                        elevSTOP();
 137   6                        open();
 138   6                        buttonPresedFlags[5] = 0;
 139   6                        down = false;
 140   6                        
 141   6                      }
 142   5                    else if (up && buttonPresedFlags[6])
 143   5                      { 
 144   6                        elevSTOP();
 145   6                        open();
 146   6                        buttonPresedFlags[6] = 0;
 147   6                        up = false;
 148   6                        
 149   6                      }
 150   5                    else if ( !up && !down )
 151   5                      {
 152   6                          open();
 153   6                        
 154   6                      }
 155   5                  }
 156   4                else
 157   4                  {
 158   5                    elevator = 2;
 159   5                  }
 160   4              }
 161   3          
 162   3          
 163   3            if(buttonPresedFlags[3]==1 || buttonPresedFlags[4]==1)  
 164   3              {
 165   4                if (sevensegmentValue == 1)
 166   4                  {
 167   5                    if( down && buttonPresedFlags[4])
 168   5                      {
 169   6                        
 170   6                        open();
 171   6                        buttonPresedFlags[4] = 0;
 172   6                        down = false;
 173   6                        
 174   6                      }
 175   5                    else if (up && buttonPresedFlags[3])
 176   5                      { 
 177   6                        open();
 178   6                        buttonPresedFlags[3] = 0;
C51 COMPILER V9.60.0.0   MAIN                                                              04/19/2020 01:28:07 PAGE 4   

 179   6                        up = false;
 180   6                      }
 181   5                    else if ( !up && !down )
 182   5                      {
 183   6                        open();
 184   6                      }
 185   5                  }
 186   4                else
 187   4                  {
 188   5                    elevator = 1;
 189   5                  }
 190   4              }
 191   3              checkPresed();
 192   3            if(sevensegmentValue < elevator)
 193   3              {
 194   4                elevUP();
 195   4                up = true;
 196   4                checkPresed();
 197   4              }
 198   3            else if(sevensegmentValue > elevator)
 199   3              {
 200   4                elecvDOWN();
 201   4                down = true;
 202   4                checkPresed();
 203   4              }
 204   3      
 205   3              
 206   3              
 207   3            
 208   3          
 209   3            if(count >= 50 && up)
 210   3            {
 211   4              sevensegmentValue++;
 212   4              seven_seg_write(0,sevensegmentValue,0);
 213   4              count = 0;
 214   4            }
 215   3          if(count >= 50 && down)
 216   3            {
 217   4              sevensegmentValue--;
 218   4              seven_seg_write(0,sevensegmentValue,0);
 219   4              count = 0;
 220   4            }
 221   3      
 222   3            
 223   3        }
 224   2            
 225   2            
 226   2      }
 227   1        }     
 228          void elevUP(void)
 229          {
 230   1        SET_BIT(P2,0);
 231   1                CLR_BIT(P2,1);
 232   1      }
 233          void elecvDOWN(void)
 234          {
 235   1      CLR_BIT(P2,0);
 236   1                SET_BIT(P2,1);
 237   1      }
 238          void elevSTOP(void)
 239          {
 240   1        CLR_BIT(P2,0);
C51 COMPILER V9.60.0.0   MAIN                                                              04/19/2020 01:28:07 PAGE 5   

 241   1                CLR_BIT(P2,1);
 242   1      }
 243          void open(void)
 244          {
 245   1      SET_BIT(P2,4);
 246   1      CLR_BIT(P2,5);
 247   1      } 
 248          void close(void)
 249          {
 250   1      CLR_BIT(P2,4);
 251   1      SET_BIT(P2,5);
 252   1      } 
 253          void stop(void)
 254          {
 255   1      CLR_BIT(P2,5);
 256   1        CLR_BIT(P2,4);
 257   1      }
 258            
 259          
 260          
 261          void checkPresed(void)
 262            {
 263   1          for(step=0;step<8;step++)
 264   1          {
 265   2            buttonPresed[step]=DIO_read(3,step);
 266   2            delay_ms(1);
 267   2          }
 268   1          for(step=0;step<8;step++)
 269   1          {
 270   2            if(0 == buttonPresed[step])
 271   2            {
 272   3              buttonPresedFlags[step] = 1;
 273   3            }
 274   2          }
 275   1        }
 276              


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    660    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     39    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
